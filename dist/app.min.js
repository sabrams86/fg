"use strict";var app=angular.module("friendlyGear",["ngRoute","ngCookies","jkuri.bookingcalendar"]);app.config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"/partials/splash.html",controller:"SplashController"}).when("/home",{templateUrl:"/partials/home.html",controller:"HomeController"}).when("/signup",{templateUrl:"/partials/signup.html",controller:"SignUpController"}).when("/users/:id",{templateUrl:"/partials/users/show.html",controller:"UsersController"}).when("/users/:id/edit",{templateUrl:"/partials/users/edit.html",controller:"UsersController"}).when("/items/new",{templateUrl:"/partials/items/new.html",controller:"ItemsController"}).when("/items/:id",{templateUrl:"/partials/items/show.html",controller:"ShowItemController"}).when("/items/:id/edit",{templateUrl:"/partials/items/edit.html",controller:"EditItemController"}).when("/admin/categories",{templateUrl:"/partials/categories/index.html",controller:"CategoriesController"}).when("/items/:itemId/contracts/new",{templateUrl:"/partials/contracts/new.html",controller:"ContractsController"}).when("/items/:itemId/contracts/:id",{templateUrl:"/partials/contracts/show.html",controller:"ShowContractsController"}).when("/items/:itemId/contracts/edit",{templateUrl:"/partials/contracts/edit.html",controller:"ContractsController"}).otherwise({redirectTo:"/"}),e.html5Mode(!0)}]),app.directive("categoryDropdown",function(){return{link:function(t,e,n){angular.forEach(e.find("#multi-select"),function(t){$(t).dropdown()})},templateUrl:"/partials/templates/dropdown.html"}}),app.directive("searchableCategoryDropdown",function(){return{link:function(t,e,n){angular.forEach(e.find("#search-select"),function(t){$(t).dropdown()})},templateUrl:"/partials/templates/search_dropdown.html"}}),angular.module("jkuri.bookingcalendar",[]).factory("MultiCalendarService",["$http",function(t){var e=this;return e.getData=function(e,n,o,r){var a={id:n,from:o,to:r};return t.get(e,a)},e}]).directive("fgBookingCalendar",["$timeout","MultiCalendarService",function(t,e){var n=function(t,e){t.firstWeekDaySunday=t.$eval(e.firstWeekDaySunday)||!1,t.locale=e.locale||"en",t.num=e.num||3,t.numMonthsText=e.numMonthsText||"Number of months:",t.id=e.id||null,t.url=e.url||"data/example_data.json"};return{restrict:"EA",link:function(t,o,r){n(t,r),t.calendars=[],t.dayNames=[],t.displayMonthsOpts=[3,6,9,12],t.num=t.displayMonthsOpts[t.displayMonthsOpts.indexOf(parseInt(t.num,10))],moment.locale(t.locale);var a=moment(),i=moment(),s=function(){for(var e=t.firstWeekDaySunday===!0?moment("2015-06-07"):moment("2015-06-01"),n=0;7>n;n+=1)t.dayNames.push(e.format("ddd")),e.add("1","d")};s();var c=function(e,n){var o={},r=e.endOf("month").date(),a=e.month(),s=e.year(),c=1,u=!1,d=!1,p=!1,m=t.firstWeekDaySunday===!0?e.set("date",2).day():e.set("date",1).day();1!==m&&(c-=m-1),t.dateValue=e.format("MMMM YYYY"),o.days=[];for(var h=c;r>=h;h+=1){u=!1;var f=moment(s+"-"+(a+1)+"-"+h,"YYYY-MM-DD"),g=f.format("YYYY-MM-DD");h>0?(u=l[g]===!1?!0:!1,d=i>f?!0:!1,p=g===i.format("YYYY-MM-DD")?!0:!1,o.days.push({day:h,month:a+1,year:s,enabled:!0,busy:u,past_day:d,is_today:p})):o.days.push({day:null,month:null,year:null,enabled:!1,busy:u})}return o.dateValue=e.format("MMMM YYYY"),o},l={},u=function(n){t.calendars=[],l={},t.loading=!0;var o=angular.copy(a),r=o.set("date",1).format("YYYY-MM-DD"),i=o.set("month",o.month()+t.num-1).set("date",o.endOf("month").date()).format("YYYY-MM-DD");e.getData(t.url,t.id,r,i).then(function(e){e.data.forEach(function(t){l[t.date]=t.is_available});for(var o=0;n>o;o+=1)t.calendars.push(c(a,l)),a.add("1","M");t.loading=!1})};t.selectDate=function(t,e){console.log(t),console.log(e)},t.prevMonth=function(){var e=angular.copy(a);e.subtract(3,"M").month()!==i.month()&&(a.subtract(parseInt(t.num,10)+1,"M"),u(t.num))},t.nextMonth=function(){a.subtract(parseInt(t.num,10)-1,"M"),u(t.num)},t.$watch("num",function(){a=moment(),u(parseInt(t.num,10))})},template:'<div class="ng-multi-calendar">  <div class="ng-multi-calendar-select">    <label>{{ numMonthsText }}    <select ng-model="num" ng-options="n for n in displayMonthsOpts">    </select>    </label>  </div>  <div class="ng-multi-calendar-loader" ng-show="loading"><div class="uil-ring-css"><div></div></div></div>  <div class="left">    <i class="fa fa-angle-left" ng-click="prevMonth()"></i>  </div>  <div class="calendar" ng-repeat="c in calendars">    <div class="month-name"><span ng-bind="c.dateValue" class="date"></span></div>    <div class="day-names">      <span ng-repeat="dn in dayNames">        <span ng-bind="dn"></span>      </span>    </div>    <div class="days">      <span ng-repeat="d in c.days">        <span class="day" ng-click="selectDate($event, d)" ng-class="{busy: d.busy, past: d.past_day, today: d.is_today}">{{ d.day }}</span>      </span>    </div>  </div>  <div class="right">    <i class="fa fa-angle-right" ng-click="nextMonth()"></i>  </div></div>'}}]),app.directive("userAuthDirective",function(){return{scope:{},controller:["$scope","$location","$cookies","UserService","AuthService",function(t,e,n,o,r){r.checkLoggedIn().then(function(e){t.userLoggedIn=!0,t.currentUser=n.get("user")},function(e){t.userLoggedIn=!1}),t.logout=function(){n.remove("user"),t.userLoggedIn=!1,e.path("/")},t.login=function(){r.login({username:t.username,password:t.password}).then(function(e){t.userLoggedIn=!0})}}],templateUrl:"/partials/templates/userLogin.html"}}),app.controller("CategoriesController",["$scope","$location","CategoryService",function(t,e,n){n.getCategories().then(function(e){t.categories=e}),t.createCategory=function(){t.categoryData={category:{name:t.name,parent:t.parent}},n.createCategory(this.categoryData).then(function(e){t.categories.push(e),t.name="",t.parent=""})},t.deleteCategory=function(e){n.deleteCategory(e._id).then(function(){t.categories.splice(e,1)})}}]),app.controller("HomeController",["$scope","$location","$cookies","ItemService","CategoryService",function(t,e,n,o,r){o.getAllItems("").then(function(e){t.items=e}),r.getCategories().then(function(e){t.categories=e}),t.newItem=function(){e.path("/items/new")},t.filterCategory=function(e){o.getAllItems("?category="+e.name).then(function(e){t.items=e})}}]),app.controller("ItemsController",["$scope","$cookies","$location","ItemService","CategoryService",function(t,e,n,o,r){r.getCategories().then(function(e){t.categories=e}),t.newItem=function(){n.path("/items/new")},t.createItem=function(){console.log(t.categories),t.itemData={item:{name:t.name,brand:t.brand,condition:t.condition,datePurchased:t.datePurchased,description:t.description,imageUrl:t.imageUrl,categories:t.categories,userId:e.get("user")}},o.createItem(this.itemData).then(function(t){n.path("/items/"+t._id)})}}]),app.controller("MainController",["$scope","$location","$cookies","UserService","AuthService",function(t,e,n,o,r){r.checkLoggedIn().then(function(e){t.userLoggedIn=!0,t.currentUser=n.get("user")},function(e){t.userLoggedIn=!1}),t.logout=function(){n.remove("user"),t.userLoggedIn=!1,e.path("/")},t.login=function(){r.login({username:t.username,password:t.password}).then(function(e){t.userLoggedIn=!0})},t.signUpPage=function(){e.path("/signup")}}]),app.controller("SignUpController",["$scope","$cookies","$location","UserService",function(t,e,n,o){t.signUp=function(){t.user={user:{username:t.username,name:t.name,email:t.email,city:t.city,state:t.state,zip:t.zip,avatarUrl:t.avatarUrl,password:t.password,passwordconfirm:t.passwordconfirm}},o.signUpUser(this.user).then(function(t){n.path("/users/"+t._id)})}}]),app.controller("SplashController",["$scope","$cookies","$location","CategoryService",function(t,e,n,o){o.getCategories().then(function(e){t.categories=e}),t.search=function(){n.path("/home")},t.signUp=function(){n.path("/signup")}}]),app.controller("UsersController",["$scope","$location","$cookies","UserService","ItemService","ContractService",function(t,e,n,o,r,a){o.getUser(n.get("user")).then(function(e){return t.user=e,e},function(t){e.path("/")}).then(function(e){return r.getUserItems(e._id).then(function(n){return t.userItems=n,e})}).then(function(e){return a.getUserContracts(e._id,"owner").then(function(e){t.ownerContracts=e}),e}).then(function(e){a.getUserContracts(e._id,"renter").then(function(e){t.renterContracts=e})}),t.updateUser=function(){t.userData={user:{_id:n.get("user"),name:t.name,email:t.email,city:t.city,state:t.state,zip:t.zip,avatarUrl:t.avatarUrl,password:t.password,passwordconfirm:t.passwordconfirm}},o.updateUser(this.userData,n.get("user")).then(function(t){e.path("/users/"+t.user._id)})}}]),app.factory("AuthService",["$http","$cookies","$q",function(t,e,n){var o={};return o.login=function(n){return t.post("http://localhost:3000/login",n).then(function(t){return e.put("user",t.data._id),!0})},o.logout=function(){return e.remove("user"),!1},o.checkLoggedIn=function(){var t=n.defer();return e.get("user")?t.resolve(!0):t.reject(!1),t.promise},o}]),app.factory("CategoryService",["$http","$cookies",function(t,e){var n={};return n.getCategories=function(){return t.get("http://localhost:3000/categories").then(function(t){return t.data})},n.createCategory=function(e){return t.post("http://localhost:3000/categories",e).then(function(t){return t.data})},n.deleteCategory=function(e){return t.post("http://localhost:3000/categories/"+e+"/delete").then(function(t){return t.data})},n}]),app.factory("ContractService",["$http","$cookies","$q",function(t,e,n){var o={};return o.createContract=function(e){return t.post("http://localhost:3000/items/"+e.contract.itemId+"/contracts",e).then(function(t){return t.data})},o.getContract=function(e,n){return t.get("http://localhost:3000/items/"+e+"/contracts/"+n).then(function(t){return t.data})},o.deleteContract=function(e,n){return t.post("http://localhost:3000/items/"+e+"/contracts/"+n+"/delete").then(function(t){return t.data})},o.updateContractStatus=function(e,n,o){return t.post("http://localhost:3000/items/"+e+"/contracts/"+n+"/"+o).then(function(t){return t.data})},o.getUserContracts=function(e,n){return t.get("http://localhost:3000/contracts/"+e+"/"+n).then(function(t){return t.data})},o}]),app.factory("ItemService",["$http","$cookies",function(t,e){var n={};return n.getAllItems=function(e){return t.get("http://localhost:3000/items"+e).then(function(t){return t.data})},n.getItem=function(e){return t.get("http://localhost:3000/items/"+e).then(function(t){return t.data})},n.createItem=function(e){return t.post("http://localhost:3000/items",e).then(function(t){return t.data})},n.updateItem=function(e,n){return t.post("http://localhost:3000/items/"+n,e).then(function(t){return t.data})},n.deleteItem=function(e){return t.post("http://localhost:3000/items/"+e+"/delete")},n.getUserItems=function(e){return t.get("http://localhost:3000/users/"+e+"/user_items").then(function(t){return t.data})},n}]),app.factory("UserService",["$http","$cookies","$rootScope",function(t,e,n){var o={};return o.getUser=function(e){return t.get("http://localhost:3000/users/"+e).then(function(t){return t.data})},o.signUpUser=function(o){return t.post("http://localhost:3000/users",o).then(function(t){return e.put("user",t.data._id),n.userLoggedIn=!0,t.data})},o.updateUser=function(e,n){return t.post("http://localhost:3000/users/"+n,e).then(function(t){return t.data})},o.login=function(o){return t.post("http://localhost:3000/login",o).then(function(t){return e.put("user",t.data._id),n.userLoggedIn=!0,t.data})},o.logout=function(){n.userLoggedIn=!1,e.remove("user")},o}]),app.controller("ContractsController",["$scope","$location","$cookies","AuthService","ItemService","ContractService",function(t,e,n,o,r,a){r.getItem(e.path().split("/")[2]).then(function(e){t.item=e}),t.createContract=function(){var n=[],o=(t.startDate.split("-"),t.endDate.split("-"),{contract:{itemId:t.item._id,ownerId:t.item.userId,renterId:t.currentUser,startDate:t.startDate,endDate:t.endDate,status:"Pending"}});r.setAvailibility(n).then(function(t){t?a.createContract(o).then(function(t){e.path("/items/"+t.itemId+"/contracts/"+t._id)}):alert("Some of those dates have already been reserved, please try a different range")})}}]),app.controller("ShowContractsController",["$scope","$location","$cookies","AuthService","ItemService","ContractService",function(t,e,n,o,r,a){r.getItem(e.path().split("/")[2]).then(function(e){t.item=e}),a.getContract(e.path().split("/")[2],e.path().split("/")[4]).then(function(e){t.contract=e}),t.updateContract=function(){var n={contract:{startDate:t.startDate,endDate:t.endDate,status:t.status}};a.updateContract(n).then(function(t){e.path("/items/"+t.itemId+"/contracts/"+t._id)})},t.updateContractStatus=function(e){a.updateContractStatus(t.item._id,t.contract._id,e).then(function(n){t.contract.status=e})},t.deleteContract=function(){a.deleteContract(t.item._id,t.contract._id).then(function(n){console.log(t.item._id),e.path("/items/"+t.item._id)})}}]),app.controller("EditItemController",["$scope","$cookies","$location","ItemService",function(t,e,n,o){o.getItem(n.path().split("/")[2]).then(function(e){t.item=e}),t.updateItem=function(e){t.itemData={item:{name:t.name,brand:t.brand,condition:t.condition,description:t.description,imageUrl:t.imageUrl,categories:t.categories}},o.updateItem(this.itemData,e).then(function(t){n.path("/items/"+t._id)})}}]),app.controller("ShowItemController",["$scope","$cookies","$location","ItemService",function(t,e,n,o){o.getItem(n.path().split("/")[2]).then(function(e){t.item=e}),t.deleteItem=function(t){o.deleteItem(t).then(function(){n.path("/home")})},t.editItem=function(t){n.path("/items/"+t+"/edit")}}]);