"use strict";var app=angular.module("friendlyGear",["ngRoute","ngCookies"]);app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"/partials/splash.html",controller:"SplashController"}).when("/home",{templateUrl:"/partials/home.html",controller:"HomeController"}).when("/signup",{templateUrl:"/partials/signup.html",controller:"SignUpController"}).when("/users/:id",{templateUrl:"/partials/users/show.html",controller:"UsersController"}).when("/users/:id/edit",{templateUrl:"/partials/users/edit.html",controller:"UsersController"}).when("/items/new",{templateUrl:"/partials/items/new.html",controller:"ItemsController"}).when("/items/:id",{templateUrl:"/partials/items/show.html",controller:"ShowItemController"}).when("/items/:id/edit",{templateUrl:"/partials/items/edit.html",controller:"EditItemController"}).when("/admin/categories",{templateUrl:"/partials/categories/index.html",controller:"CategoriesController"}).otherwise({redirectTo:"/"}),t.html5Mode(!0)}]),app.controller("CategoriesController",["$scope","$location","CategoryService",function(e,t,n){n.getCategories().then(function(t){e.categories=t}),e.createCategory=function(){e.categoryData={category:{name:e.name,parent:e.parent}},n.createCategory(this.categoryData).then(function(t){e.categories.push(t),e.name="",e.parent=""})},e.deleteCategory=function(t){n.deleteCategory(t._id).then(function(){e.categories.splice(t,1)})}}]),app.controller("HomeController",["$scope","$location","$cookies","ItemService","CategoryService",function(e,t,n,o,r){o.getAllItems("").then(function(t){e.items=t}),r.getCategories().then(function(t){e.categories=t}),e.newItem=function(){t.path("/items/new")},e.filterCategory=function(t){o.getAllItems("?category="+t.name).then(function(t){e.items=t})}}]),app.controller("ItemsController",["$scope","$cookies","$location","ItemService","CategoryService",function(e,t,n,o,r){r.getCategories().then(function(t){e.categories=t}),e.newItem=function(){n.path("/items/new")},e.createItem=function(){console.log(e.categories),e.itemData={item:{name:e.name,brand:e.brand,condition:e.condition,datePurchased:e.datePurchased,description:e.description,imageUrl:e.imageUrl,categories:e.categories,userId:t.get("user")}},o.createItem(this.itemData).then(function(e){n.path("/items/"+e._id)})}}]),app.controller("MainController",["$scope","$location","$cookies","UserService","AuthService",function(e,t,n,o,r){r.checkLoggedIn().then(function(t){e.userLoggedIn=!0},function(t){e.userLoggedIn=!1}),e.logout=function(){n.remove("user"),e.userLoggedIn=!1,t.path("/")},e.login=function(){r.login({username:e.username,password:e.password}).then(function(t){e.userLoggedIn=!0})},e.signUpPage=function(){t.path("/signup")}}]),app.controller("SignUpController",["$scope","$cookies","$location","UserService",function(e,t,n,o){e.signUp=function(){e.user={user:{username:e.username,name:e.name,email:e.email,city:e.city,state:e.state,zip:e.zip,avatarUrl:e.avatarUrl,password:e.password,passwordconfirm:e.passwordconfirm}},o.signUpUser(this.user).then(function(e){n.path("/users/"+e._id)})}}]),app.controller("SplashController",["$scope","$cookies","$location",function(e,t,n){e.search=function(){n.path("/home")},e.signUp=function(){n.path("/signup")}}]),app.controller("UsersController",["$scope","$location","$cookies","UserService","ItemService",function(e,t,n,o,r){o.getUser(n.get("user")).then(function(t){return e.user=t,t},function(e){t.path("/")}).then(function(t){return r.getUserItems(t._id).then(function(t){return e.userItems=t,t})}),e.updateUser=function(){e.userData={user:{_id:n.get("user"),name:e.name,email:e.email,city:e.city,state:e.state,zip:e.zip,avatarUrl:e.avatarUrl,password:e.password,passwordconfirm:e.passwordconfirm}},o.updateUser(this.userData,n.get("user")).then(function(e){t.path("/users/"+e.user._id)})}}]),app.directive("categoryDropdown",function(){return{link:function(e,t,n){angular.forEach(t.find("#multi-select"),function(e){$(e).dropdown()})},templateUrl:"/partials/templates/dropdown.html"}}),app.directive("userAuthDirective",function(){return{scope:{},controller:["$scope","$location","$cookies","UserService","AuthService",function(e,t,n,o,r){r.checkLoggedIn().then(function(t){e.userLoggedIn=!0,e.currentUser=n.get("user")},function(t){e.userLoggedIn=!1}),e.logout=function(){n.remove("user"),e.userLoggedIn=!1,t.path("/")},e.login=function(){r.login({username:e.username,password:e.password}).then(function(t){e.userLoggedIn=!0})}}],templateUrl:"/partials/templates/userLogin.html"}}),app.factory("AuthService",["$http","$cookies","$q",function(e,t,n){var o={};return o.login=function(n){return e.post("http://localhost:3000/login",n).then(function(e){return t.put("user",e.data._id),!0})},o.logout=function(){return t.remove("user"),!1},o.checkLoggedIn=function(){var e=n.defer();return t.get("user")?e.resolve(!0):e.reject(!1),e.promise},o}]),app.factory("CategoryService",["$http","$cookies",function(e,t){var n={};return n.getCategories=function(){return e.get("http://localhost:3000/categories").then(function(e){return e.data})},n.createCategory=function(t){return e.post("http://localhost:3000/categories",t).then(function(e){return e.data})},n.deleteCategory=function(t){return e.post("http://localhost:3000/categories/"+t+"/delete").then(function(e){return e.data})},n}]),app.factory("ItemService",["$http","$cookies",function(e,t){var n={};return n.getAllItems=function(t){return e.get("http://localhost:3000/items"+t).then(function(e){return e.data})},n.getItem=function(t){return e.get("http://localhost:3000/items/"+t).then(function(e){return e.data})},n.createItem=function(t){return e.post("http://localhost:3000/items",t).then(function(e){return e.data})},n.updateItem=function(t,n){return e.post("http://localhost:3000/items/"+n,t).then(function(e){return e.data})},n.deleteItem=function(t){return e.post("http://localhost:3000/items/"+t+"/delete")},n.getUserItems=function(t){return e.get("http://localhost:3000/users/"+t+"/user_items").then(function(e){return e.data})},n}]),app.factory("UserService",["$http","$cookies","$rootScope",function(e,t,n){var o={};return o.getUser=function(t){return e.get("http://localhost:3000/users/"+t).then(function(e){return e.data})},o.signUpUser=function(o){return e.post("http://localhost:3000/users",o).then(function(e){return t.put("user",e.data._id),n.userLoggedIn=!0,e.data})},o.updateUser=function(t,n){return e.post("http://localhost:3000/users/"+n,t).then(function(e){return e.data})},o.login=function(o){return e.post("http://localhost:3000/login",o).then(function(e){return t.put("user",e.data._id),n.userLoggedIn=!0,e.data})},o.logout=function(){n.userLoggedIn=!1,t.remove("user")},o}]),app.controller("EditItemController",["$scope","$cookies","$location","ItemService",function(e,t,n,o){o.getItem(n.path().split("/")[2]).then(function(t){e.item=t}),e.updateItem=function(t){e.itemData={item:{name:e.name,brand:e.brand,condition:e.condition,description:e.description,imageUrl:e.imageUrl,categories:e.categories}},o.updateItem(this.itemData,t).then(function(e){n.path("/items/"+e._id)})}}]),app.controller("ShowItemController",["$scope","$cookies","$location","ItemService",function(e,t,n,o){o.getItem(n.path().split("/")[2]).then(function(t){e.item=t}),e.deleteItem=function(e){o.deleteItem(e).then(function(){n.path("/home")})},e.editItem=function(e){n.path("/items/"+e+"/edit")}}]);